(()=>{"use strict";var e,t,a,n,o={88:(e,t,a)=>{a.d(t,{yp:()=>c});const n=document.createElement("div");n.className="popup-overlay";const o=document.createElement("div");o.className="popup-window",n.appendChild(o);const i=document.createElement("span");o.appendChild(i);const r=document.createElement("span");r.id="customElementPlaceHolder",o.appendChild(r);const s=document.createElement("span");function c(e){const t=[];n.style.display="flex",e.text?i.innerText=e.text:i.innerText="",e.customElement&&(r.appendChild(e.customElement),t.push(e.customElement));for(const a of e.buttons){const e=document.createElement("button");e.className="button-flexatar-style",e.innerText=a.text,s.appendChild(e),t.push(e),e.onclick=()=>{a.onclick((()=>{for(const e of t)e.remove();i.innerText="",n.style.display="none"}))}}}o.appendChild(s),s.style.display="flex",s.style.flexDirection="row",s.style.gap="20px",s.style.justifyContent="center",s.style.alignItems="center",document.body.appendChild(n),n.style.display="none"},217:(e,t,a)=>{a.d(t,{n:()=>o,OC:()=>i,z3:()=>r});const n="ftarcache";async function o(e,t){const a=await async function(e){const t=await caches.open(n),a=await t.match(e);if(!a)return null;const o=await a.arrayBuffer();return new Uint8Array(o)}("/ftar/"+e.id);if(a)return{data:a,ready:Promise.resolve(!0),id:e.id,name:e.meta?.name};const o=await FtarView.flexatarEntry(t,e.id,{ftar:!0}),i=await FtarView.getFlexatar(o);return await async function(e,t){const a=await caches.open(n),o=new Response(t,{headers:{"Content-Type":"application/octet-stream"}});await a.put(e,o)}("/ftar/"+e.id,i.data),i}async function i(e){const t=await async function(e){const t=await caches.open(n),a=await t.match(e);if(!a)return null;const o=await a.blob();return URL.createObjectURL(o)}("/ftarpreview/"+e.id);if(t)return t;const a=await FtarView.getPreview(e);return await async function(e,t){const a=await async function(e){const t=await fetch(e);return await t.blob()}(t),o=await caches.open(n),i=new Response(a,{headers:{"Content-Type":a.type||"application/octet-stream"}});await o.put(e,i)}("/ftarpreview/"+e.id,a),a}async function r(e){const[t,a]=await async function(){const e=await caches.open(n);return[await e.keys(),e]}();for(const n of t){const t=n.url.split("/"),o=t[t.length-1];let i=!0;for(const t of e)if(t.id==o){i=!1;break}i&&a.delete(n)}}},44:(e,t,a)=>{a.a(e,(async(e,t)=>{try{var n=a(807),o=a(217),i=a(616),r=a(766),s=a(88),c=e([i]);i=(c.then?(await c)():c)[0];const l=["audio/aac","audio/ogg","audio/webm","audio/webm;codecs=opus","audio/webm;codecs=pcm","audio/ogg;codecs=opus","audio/ogg;codecs=vorbis","audio/mp4","audio/mp4;codecs=aac","audio/mpeg","audio/wav"].filter((e=>MediaRecorder.isTypeSupported(e)));let d;(0,r.M)("startRecFromMicButton","timerOutput",(()=>{starRecLogo.classList.add("invisible"),stopRecLogo.classList.remove("invisible"),timerOutput.classList.remove("invisible"),startRecFromMicButton.classList.add("mic-record-state"),ue.dropZone.classList.add("invisible"),timerOutput.classList.add("drop-zone")}),(()=>{starRecLogo.classList.remove("invisible"),stopRecLogo.classList.add("invisible"),timerOutput.classList.add("invisible"),timerOutput.classList.remove("drop-zone"),startRecFromMicButton.classList.remove("mic-record-state"),ue.dropZone.classList.remove("invisible")}),(async(e,t)=>{const a=await fetch(t),n=await a.blob(),o=new File([n],"Recorded."+l[0].split("/")[1],{type:l[0]}),i=new DataTransfer;i.items.add(o),ue.input.files=i.files;const r=new Event("change",{bubbles:!0});ue.input.dispatchEvent(r)}),(()=>{console.log("permission error"),O(i.T.noMicPerm)}),(()=>{O(i.T.recTooShort),console.log("record to short")}),(e=>{O(i.T.somethingWenWrong),console.log("unknown error",e)}),300,l[0]),window.addEventListener("message",(async e=>{let t=e.data;if(t.flexatar)if(t=t.flexatar,"reload_token"===t.type)d(t.token);else if("heart_beat"===t.type){console.log("iframe heart beat");const e={};e[f]={type:"heart_beat"},window.parent.postMessage({flexatar:e},"*")}}));const p=window.location.search;let u,f;new URLSearchParams(p).forEach(((e,t)=>{"id"===t&&(f=e)})),u=new FtarView.GetToken((async()=>{const e=new Promise((e=>{d=e})),t={};t[f]={type:"reload_token"},window.parent.postMessage({flexatar:t},"*");const a=await e;return u.token=a,a}));const m=[chooseMainPanelButton,settingsMainPanelButton,audioMainPanelButton,recordMainPanelButton],h=new FtarView.util.DispatchQueue;let w;j(!0),videosMainPanelButton.disabled=!0;let v,g={};async function y(e){return e in g||(loaderSign.classList.remove("invisible"),g[e]=await(0,o.n)({id:e},u),loaderSign.classList.add("invisible")),g[e]}let b,E,L,T=[null,null];async function R(e,t,a,n,o){const i=document.createElement("img");i.src=n,i.className="ftar-preview-size",i.ftarEntry=e;const r=o;return 0==C[0].length&&(A[0]=e.id,A[1]=e.id,S[0]=0,S[1]=0,0==r&&(v=n),j(!1)),i.onclick=async()=>{T[r]&&T[r].classList.remove("active"),T[r]=i,i.classList.add("active");const a=C[r].indexOf(i);S[r]=a,0==r&&(v=n),await y(e.id),A[r]=e.id,0==r?t.slot1=g[e.id]:t.slot2=g[e.id],t.effect=Se?()=>({mode:2,parameter:.35}):FtarView.effect.no(),t.start(),t.canvas.width=75,t.canvas.height=100},a.appendChild(i),i}const C=[[],[]];async function x(){if(b.length>=1){const e=b[0];await y(e.id),S[0]=0,S[1]=0,E.slot1=g[e.id],A[0]=e.id,A[1]=e.id,E.pause(),E.start()}}let k=!0;async function F(){const e=await FtarView.userInfo(u);if(e.error)return e.error===FtarView.ERR_UNAUTHORIZED?void O("Authorization failed"):void O("Unknown error");audioCountContainer.style.display="none",flexatarAvalibleSign.innerText=e.FtarCount}(async()=>{if(await F(),L=new FtarView.SDK(u),E=await L.newRenderer(),"session_limit"==E.error)return O(i.T.sessionLimit),void loaderSign.classList.add("invisible");const e=await L.newAnimator();E.animator=e;for(const t of["All"].concat(e.patternList)){const e=document.createElement("option");e.text=i.T["emo"+t],e.value=t,animationSelect.appendChild(e)}if(animationSelect.disabled=!1,animationSelect.onchange=()=>{e.currentAnimationPattern=animationSelect.options[animationSelect.selectedIndex].value},b=await FtarView.flexatarList(u,{preview:!0}),b.error)return loaderSign.classList.add("invisible"),b.error===FtarView.ERR_UNAUTHORIZED?void O("Authorization failed"):void O("Unknown error");if((0,o.z3)(b),!b)return O(i.T.noService),void loaderSign.classList.add("invisible");await x(),loaderSign.classList.add("invisible");const t=new FtarView.util.DispatchQueue;let a=0;for(const e of b)t.addTask((async()=>{const t=await(0,o.OC)(e),n=await R(e,E,flexatarListContainer,t,0),i=await R(e,E,flexatarListContainer1,t,1);0==a&&j(!1),a++,C[0].push(n),C[1].push(i)}),0,!1)})();let I,S=[0,0],A=[null,null];(async()=>{I=await FtarLipsyncFile.newInstance()})();const _=["image/jpeg","image/png","image/bmp","image/webp","image/avif","image/x-portable-bitmap","image/x-portable-anymap","image/x-portable-pixmap","image/tiff"];function D(e,t){for(const a of t)if(e==a)return!0;return!1}function O(e){popup.classList.remove("invisible"),popupText.innerText=e}function B(){popup.classList.add("invisible")}let U=tabCreate,P=createMainPanelButton;async function M(e,t){U!==t&&(J?O(i.T.cantChange):(await V(U),P.classList.remove("active"),U.classList.add("invisible"),t.classList.remove("invisible"),P=e,P.classList.add("active"),U=t,t===tabChoose?await Z():t===tabRecord?(G(),te(),ye(be)):t===tabSettings&&(W(),ye(be))))}const N=chooseFtarPlaceholder;async function V(e){e&&(e===tabChoose?headerChooseContainer.replaceChild(N,E.canvas):e===tabRecord?ee():await h.addTask((async()=>{try{E.canvas.remove()}catch{}}),0,!1),recVideoElement.pause())}function j(e){for(const t of m)t.disabled=e}async function Z(){await h.addTask((async()=>{headerChooseContainer.replaceChild(E.canvas,chooseFtarPlaceholder)}),0,!1);const e=C[0][S[0]];e&&e.click();const t=C[1][S[1]];t&&t.click()}async function W(){settingsCanvasContainer.appendChild(E.canvas),E.canvas.width=240,E.canvas.height=320,await $()}async function $(){if(A[0]){const e=await y(A[0]);E.slot1=e}if(A[1]){const e=await y(A[1]);E.slot2=e}E.start(),0!=be&&ye(be)}let z;function G(){if(z)return;z=new Audio;const e=new(window.AudioContext||window.webkitAudioContext),t=FtarView.util.mediaStreamFromAudio(z,e);K=E.canvas.captureStream(30),FtarView.util.addAudioStream(K,t)}function H(e,t){const a=e.lastIndexOf(".");return-1===a?`${e}.${t}`:`${e.substring(0,a)}.${t}`}async function X(e){const t=await fetch(e),a=await t.blob();return new Promise((e=>{const t=new FileReader;t.onloadend=()=>e(t.result),t.readAsDataURL(a)}))}async function q(e,t){const a={};a[f]={type:"share_video",url:await X(e),fileName:t},window.parent.postMessage({flexatar:a},"*")}let Q,K,J=!1;async function Y(e){if(!se)return void O(i.T.prepAudio);previewButton.hidden=!0,recordButton.hidden=!0,recStop.hidden=!1,z.src=de.audioUrl;const t=de.ftarRecord.playWithPlayer(E,z);await z.play(),e&&(J=!0,Q=new FtarView.util.FlexatarRecorder(K),Q.onready=async(e,t)=>{let a,o="webm";function r(e){(0,s.yp)({text:i.T.choose,buttons:[{text:i.T.share,onclick:async t=>{t(),q(e,c)}},{text:i.T.download,onclick:async t=>{t();const a=document.createElement("a");a.href=e,a.download=c,a.click()}}]})}t.type.includes("webm")?a="mp4":o="mp4";let c=H(pe,o);const l=new ne(c,v,"download",a);let d;l.status=i.T.videoReady,l.ondownloadpressed=()=>{r(e)},l.onoptiondownloadpressed=()=>{c=H(pe,"mp4"),Re(i.T.convert,(()=>{l.onoptiondownloadpressed=null,l.optContainer.innerText=i.T.wait,(0,n.A)(t).then((e=>{l.optContainer.innerText=i.T.mp4,d=e,l.onoptiondownloadpressed=()=>{r(e)},r(e)}))}),(()=>{}))},tabVideos.appendChild(l.container),videosMainPanelButton.disabled=!1,O(i.T.findVideo)},Q.start()),z.onpause=()=>{J=!1,clearInterval(t),setTimeout((()=>{E.shutUp()}),200),Q&&Q.stop(),previewButton.hidden=!1,recordButton.hidden=!1,recStop.hidden=!0}}function ee(){z.pause(),previewButton.hidden=!1,recordButton.hidden=!1,recStop.hidden=!0}async function te(){"option1"==videoResolutionSelect.options[videoResolutionSelect.selectedIndex].value?(E.canvas.width=480,E.canvas.height=640):(E.canvas.width=240,E.canvas.height=320),recVideoElement.srcObject||(recVideoElement.srcObject=K),recVideoContainer.appendChild(E.canvas),recVideoElement.play(),await $()}class ae{constructor(e,t){this.dropZone=document.createElement("div"),this.dropZone.className="drop-zone",this.dropZoneText=document.createElement("p"),this.dropZoneText.innerText=e,this.dropZone.appendChild(this.dropZoneText);const a=document.createElement("input");this.input=a,a.type="file",a.accept=t||"image/*",a.onchange=e=>this.handleFiles(e),this.dropZone.onclick=()=>{a.click()},this.dropZone.ondragover=e=>{e.preventDefault(),this.dropZone.classList.add("hover")},this.dropZone.ondragleave=e=>{this.dropZone.classList.remove("hover")},this.dropZone.ondrop=e=>{e.preventDefault(),this.dropZone.classList.remove("hover");const t=e.dataTransfer.files;this.handleFiles({target:{files:t}})}}hide(){this.dropZone.classList.add("invisible")}show(){this.dropZone.classList.remove("invisible")}}class ne{constructor(e,t,a,n){const o=document.createElement("div");if(o.className="line-cell",t){const e=document.createElement("img");e.className="profile-photo",e.src=t,o.appendChild(e)}const i=document.createElement("div");i.className="details";const r=document.createElement("span");r.className="name",r.innerText=e,i.appendChild(r);const s=document.createElement("span");let c,l;s.className="status",s.innerText="In Progress (~20 seconds)",i.appendChild(s),o.appendChild(i),a?(n&&(l=document.createElement("div"),l.className="conver-button",l.innerText=n,o.appendChild(l),l.onclick=()=>{this.onoptiondownloadpressed&&this.onoptiondownloadpressed()}),c=document.createElement("div"),c.className="download-button material-symbols-outlined",c.innerText=a,o.appendChild(c),c.onclick=()=>{this.ondownloadpressed&&this.ondownloadpressed()}):(c=document.createElement("div"),c.className="status-dot",o.appendChild(c)),this.container=o,this.statusEl=s,this.dotContainer=c,this.optContainer=l}set status(e){this.statusEl.innerText=e}set color(e){this.dotContainer.style.backgroundColor=e}set pulse(e){e?this.dotContainer.classList.add("pulsing"):this.dotContainer.classList.remove("pulsing")}set icon(e){this.dotContainer.innerText=e}ondownloadpressed;onoptiondownloadpressed}const oe=new ae(i.T.dropPhoto);let ie,re,se,ce,le,de,pe;oe.handleFiles=e=>{const t=e.target.files[0];re=t,D(t.type,_)?(oe.hide(),ie=URL.createObjectURL(t),imgForFtarPreview.src=ie,confirmImageBlock.classList.remove("invisible"),flexatarImageDropDownContainer.classList.add("invisible")):O(i.T.notAnImage)},flexatarImageDropDownContainer.appendChild(oe.dropZone);const ue=new ae(i.T.dropAudio,"audio/*");function fe(){completionForm.classList.add("invisible"),audioDropDownContainer.classList.remove("invisible"),I.cancel(),ue.show()}function me(){confirmImageBlock.classList.add("invisible"),flexatarImageDropDownContainer.classList.remove("invisible"),oe.show()}async function he(){const e=new ne(re.name,ie);e.color="orange",e.pulse=!0,imageListContanier.insertBefore(e.container,imageListContanier.firstChild),me();const t=await FtarView.makeFlexatar(u,re,"noname",{ftar:!0,preview:!0});if(!t)return e.status=i.T.unknownErr,e.color="red",void(e.pulse=!1);if(t.err)return t.reason?"queue_limit"===t.reason?e.status=i.T.onlyOne:"subscription_limit"===t.reason&&(e.status=i.T.outOfSubs):e.status=i.T.badPhoto,e.color="red",void(e.pulse=!1);e.status=i.T.ready,e.color="green",e.pulse=!1;const a=await(0,o.OC)(t),n=await R(t,E,flexatarListContainer,a,0),r=await R(t,E,flexatarListContainer1,a,1);C[0].push(n),C[1].push(r),1==C[0].length&&(g[t.id]=await FtarView.getFlexatar(t),S[0]=0,S[1]=0,A[0]=t.id,A[1]=t.id),setTimeout((()=>{F()}),1e3)}ue.handleFiles=async e=>{const t=e.target.files[0];if(!t.type.startsWith("audio/"))return void O(i.T.notAnAudio);const a=URL.createObjectURL(t);let n;ce=a,audioProgressBar.style.width="0%",fileNameHolder.innerText=t.name,pe=t.name,ue.hide(),completionForm.classList.remove("invisible"),audioDropDownContainer.classList.add("invisible"),k||(n=fetch("https://api.flexatar-sdk.com/checkoptional/AudioCount",{method:"GET",headers:{Authorization:"Bearer "+u}})),readyIndicator.innerText=i.T.processinTime;let o,r="";I.makeAnimation(t,(async e=>{if(!(audioProgressBar.style.width="100%",readyIndicator.innerText=i.T.processComplete,k||(await fetch("https://api.flexatar-sdk.com/chargeoptional/AudioCount/"+Math.floor(o),{method:"GET",headers:{Authorization:"Bearer "+u}})).ok))return O("Service Unavailable"),void fe();se=new FtarView.FtarRecord(e),le&&(le.icon="check_box_outline_blank");const n=new ne(t.name,void 0,"select_check_box");n.status=r,le=n,audioListContanier.insertBefore(n.container,audioListContanier.firstChild),n.ftarRecord=se,n.audioUrl=a,n.ondownloadpressed=()=>{le&&(le.icon="check_box_outline_blank",n.icon="select_check_box",de=n,pe=t.name),le=n},de=n,fe()}),(e=>{audioProgressBar.style.width=`${Math.floor(e)}%`}),(async e=>{if(k)return!0;o=e.duration,r=new Date(1e3*e.duration).toISOString().substring(11,19);const t=await n;return t.ok?!((await t.json()).count<e.duration&&(O("Out of Subscribtion"),fe(),1)):(O("No connection to service"),!1)}))},audioDropDownContainer.appendChild(ue.dropZone);const we=new ae(i.T.dropBkg);function ve(){removeBackgroundButton.hidden=!0,we.show(),E.addOverlay(null,{x:0,y:0,width:100,height:100,mode:"back"})}function ge(e){if("string"!=typeof e)throw new Error("Invalid input: color must be a string.");if(e.startsWith("#")&&(e=e.slice(1)),!/^([A-Fa-f0-9]{3}|[A-Fa-f0-9]{6})$/.test(e))throw new Error("Invalid hex color format.");3===e.length&&(e=e.split("").map((e=>e+e)).join(""));const t=parseInt(e.slice(0,2),16)/255,a=parseInt(e.slice(2,4),16)/255,n=parseInt(e.slice(4,6),16)/255;if(isNaN(t)||isNaN(a)||isNaN(n))throw new Error("Failed to parse the hex color.");return[t,a,n]}function ye(e){toggleEffectAnimation.checked?1==e?E.effect=FtarView.effect.morph():2==e?E.effect=FtarView.effect.hybrid():0==e&&(E.effect=FtarView.effect.no()):effectSlider.dispatchEvent(new Event("change"))}we.handleFiles=async e=>{const t=e.target.files[0];if(!D(t.type,_))return void O(i.T.notAnImage);const a=await FtarView.util.resizeImageToWidth(t,480),n=URL.createObjectURL(a),o=await L.newOverlay(n);E.addOverlay(o,{x:0,y:0,width:100,height:100,mode:"back"}),we.hide(),removeBackgroundButton.hidden=!1},backgroundZone.appendChild(we.dropZone),colorInput.oninput=e=>{const t=e.target.value;try{E.backgroundColor=ge(t)}catch{}},effectSlider.disabled=!0;let be=0;const Ee=[noEffectButton,morphEffectButton,hybridEffectButton];function Le(e,t){if(be!=e){be=e;for(const e of Ee)if(e===t)e.classList.add("active");else try{e.classList.remove("active")}catch{}effectSlider.disabled=0==be,0==be?(E.effect=FtarView.effect.no(),effectSlider.disabled=!0):(effectSlider.disabled=!1,ye(be))}}function Te(){Re(i.T.deleteQuest,(async()=>{const e=C[0][S[0]].ftarEntry;if(e.token=u,!await FtarView.deleteFlexatar(e))return void O(i.T.wentWrong);C[0][S[0]].remove(),C[0].splice(S[0],1),C[1][S[0]].remove(),C[1].splice(S[0],1),b.splice(S[0],1);const t=S[0];if(S[0]>=C[0].length&&S[0]--,0==C[0].length)return S[0]=0,S[1]=0,createMainPanelButton.click(),void j(!0);S[1]>t?(S[1]--,A[1]=C[0][S[1]].ftarEntry.id,E.slot2=g[A[1]]):S[1]==t&&(S[1]=S[0],A[1]=C[0][S[1]].ftarEntry.id,E.slot2=g[A[1]]),w=null;const a=C[0][S[0]].ftarEntry;await y(a.id),A[0]=a.id,E.slot1=g[a.id]}),(()=>{}))}function Re(e,t,a){xe=()=>{a(),popupConfirm.classList.add("invisible")},Ce=()=>{t(),popupConfirm.classList.add("invisible")},confirmText.innerText=e,popupConfirm.classList.remove("invisible")}let Ce,xe;function ke(){Ce&&Ce()}function Fe(){xe&&xe()}function Ie(){recVideoElement.muted=!recVideoElement.muted,recVideoElement.muted?muteButton.innerText="volume_up":muteButton.innerText="volume_off"}toggleEffectAnimation.onchange=()=>{ye(be)},effectSlider.onchange=()=>{0!=be?(E.effect=()=>({mode:be,parameter:effectSlider.value/100}),toggleEffectAnimation.checked=!1):E.effect=FtarView.effect.no()},recVideoElement.muted=!1,window.showTab=M,window.sendImgToCreateFtar=he,window.resetInputImgForFtar=me,window.cancelAudio=fe,window.muteAudioWhileRecording=Ie,window.startPreview=Y,window.cancelPreviewRec=ee,window.cancelBackground=ve,window.chooseEffect=Le,window.deleteFlexatar=Te,window.hidePopup=B,window.confirmChosen=ke,window.cancelChosen=Fe;let Se=!1;slot2Expand.onclick=()=>{slot2Label.classList.remove("invisible"),slot2Close.classList.remove("invisible"),flexatarListContainer1.classList.remove("invisible"),slot2Expand.classList.add("invisible"),E.effect=()=>({mode:2,parameter:.35}),Se=!0},slot2Close.onclick=()=>{slot2Label.classList.add("invisible"),slot2Close.classList.add("invisible"),slot2Expand.classList.remove("invisible"),flexatarListContainer1.classList.add("invisible"),E.effect=FtarView.effect.no(),Se=!1},t()}catch(Ae){t(Ae)}}))},616:(e,t,a)=>{a.a(e,(async(e,n)=>{try{a.d(t,{T:()=>i});const e=await(await fetch("./res/locale_en.json")).json(),o=e.html;for(const e in o)document.getElementById(e).textContent=o[e];const i=e.js;n()}catch(e){n(e)}}),1)},766:(e,t,a)=>{function n(e){try{const t=Math.floor(e/3600),a=Math.floor(e%3600/60),n=Math.round(e%60);return`${String(t).padStart(2,"0")}-${String(a).padStart(2,"0")}-${String(n).padStart(2,"0")}`}catch(e){return"00-00-00"}}function o(e,t,a,o,i,r,s,c,l=1/0,d){let p,u,f=!1,m=0;const h=document.getElementById(t);try{return p=function(e,t,a,n,o,i){let r,s,c=0;const{getAudioStream:l,disableMicrophone:d}=function(){let e=null;return{getAudioStream:async()=>{try{return e||(e=await navigator.mediaDevices.getUserMedia({audio:!0})),{stream:e}}catch(e){return{error:"Failed to access microphone"}}},disableMicrophone:()=>{e&&(e.getTracks().forEach((e=>e.stop())),e=null)}}}(),{startRecord:p,stopRecord:u}=function(e,t,a,n){let o;const i=[];return{startRecord:r=>{try{o||(o=new MediaRecorder(r,{mimeType:n}),o.ondataavailable=e=>{e.data.size>0&&i.push(e.data)},o.onstop=()=>{t(i),e(),o=null,i.length=0},o.onerror=t=>{const n=`Recording error: ${t.name} - ${t.message}`;a(n),e(),o=null,i.length=0}),"inactive"===o.state&&o.start()}catch(t){const n=`Failed to start recording: ${t.message}`;a(n),e()}},stopRecord:()=>{try{o&&"inactive"!==o.state&&o.stop()}catch(t){const n=`Failed to stop recording: ${t.message}`;a(n),e()}}}}((()=>{clearInterval(r),t()}),(e=>{const t=new Blob(e,{type:i});a(t,c)}),(e=>{clearInterval(r),o(e),t()}),i);return{startRecording:async function(){try{c=0;const a=await l();if(a.error)return n(a.error),void t();const{stream:o}=a;p(o),s=Date.now(),r=setInterval((()=>{c=Math.floor((Date.now()-s)/1e3),e(c)}),1e3)}catch(e){n(e.toString()),t()}},stopRecording:function(){clearInterval(r),u(),d()}}}((e=>{m=e,h.textContent=n(m)}),(()=>{f=!1,o(),clearTimeout(u)}),((e,t)=>{if(t<3)s(new Error("Too fast clicking"));else{const a=URL.createObjectURL(e);i(t,a)}}),(e=>{r(new Error(e))}),(e=>{c(new Error(e))}),d),document.getElementById(e).addEventListener("click",(()=>{f?p.stopRecording():(h.textContent=n(0),a(),f=!0,u=setTimeout((()=>{p.stopRecording()}),1e3*l),p.startRecording())})),null}catch(e){return e}}a.d(t,{M:()=>o})},807:(e,t,a)=>{var n;a.d(t,{A:()=>m}),function(e){e.LOAD="LOAD",e.EXEC="EXEC",e.FFPROBE="FFPROBE",e.WRITE_FILE="WRITE_FILE",e.READ_FILE="READ_FILE",e.DELETE_FILE="DELETE_FILE",e.RENAME="RENAME",e.CREATE_DIR="CREATE_DIR",e.LIST_DIR="LIST_DIR",e.DELETE_DIR="DELETE_DIR",e.ERROR="ERROR",e.DOWNLOAD="DOWNLOAD",e.PROGRESS="PROGRESS",e.LOG="LOG",e.MOUNT="MOUNT",e.UNMOUNT="UNMOUNT"}(n||(n={}));const o=(()=>{let e=0;return()=>e++})(),i=(new Error("unknown message type"),new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first")),r=new Error("called FFmpeg.terminate()");new Error("failed to import ffmpeg-core.js");const s=new Error("failed to get response body reader"),c=new Error("failed to complete download"),l=async e=>{let t;if("string"==typeof e)t=/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(e)?atob(e.split(",")[1]).split("").map((e=>e.charCodeAt(0))):await(await fetch(e)).arrayBuffer();else if(e instanceof URL)t=await(await fetch(e)).arrayBuffer();else{if(!(e instanceof File||e instanceof Blob))return new Uint8Array;t=await(a=e,new Promise(((e,t)=>{const n=new FileReader;n.onload=()=>{const{result:t}=n;t instanceof ArrayBuffer?e(new Uint8Array(t)):e(new Uint8Array)},n.onerror=e=>{t(Error(`File could not be read! Code=${e?.target?.error?.code||-1}`))},n.readAsArrayBuffer(a)})))}var a;return new Uint8Array(t)},d=async(e,t,a=!1,n)=>{const o=a?await(async(e,t)=>{const a=await fetch(e);let n;try{const o=parseInt(a.headers.get("Content-Length")||"-1"),i=a.body?.getReader();if(!i)throw s;const r=[];let l=0;for(;;){const{done:a,value:n}=await i.read(),s=n?n.length:0;if(a){if(-1!=o&&o!==l)throw c;t&&t({url:e,total:o,received:l,delta:s,done:a});break}r.push(n),l+=s,t&&t({url:e,total:o,received:l,delta:s,done:a})}const d=new Uint8Array(l);let p=0;for(const e of r)d.set(e,p),p+=e.length;n=d.buffer}catch(o){console.log("failed to send download progress event: ",o),n=await a.arrayBuffer(),t&&t({url:e,total:n.byteLength,received:n.byteLength,delta:0,done:!0})}return n})(e,n):await(await fetch(e)).arrayBuffer(),i=new Blob([o],{type:t});return URL.createObjectURL(i)},p=new class{#e=null;#t={};#a={};#n=[];#o=[];loaded=!1;#i=()=>{this.#e&&(this.#e.onmessage=({data:{id:e,type:t,data:a}})=>{switch(t){case n.LOAD:this.loaded=!0,this.#t[e](a);break;case n.MOUNT:case n.UNMOUNT:case n.EXEC:case n.FFPROBE:case n.WRITE_FILE:case n.READ_FILE:case n.DELETE_FILE:case n.RENAME:case n.CREATE_DIR:case n.LIST_DIR:case n.DELETE_DIR:this.#t[e](a);break;case n.LOG:this.#n.forEach((e=>e(a)));break;case n.PROGRESS:this.#o.forEach((e=>e(a)));break;case n.ERROR:this.#a[e](a)}delete this.#t[e],delete this.#a[e]})};#r=({type:e,data:t},a=[],n)=>this.#e?new Promise(((i,r)=>{const s=o();this.#e&&this.#e.postMessage({id:s,type:e,data:t},a),this.#t[s]=i,this.#a[s]=r,n?.addEventListener("abort",(()=>{r(new DOMException(`Message # ${s} was aborted`,"AbortError"))}),{once:!0})})):Promise.reject(i);on(e,t){"log"===e?this.#n.push(t):"progress"===e&&this.#o.push(t)}off(e,t){"log"===e?this.#n=this.#n.filter((e=>e!==t)):"progress"===e&&(this.#o=this.#o.filter((e=>e!==t)))}load=({classWorkerURL:e,...t}={},{signal:o}={})=>(this.#e||(this.#e=e?new Worker(new URL(e,"file:///home/naospennikov/workspace/flexatar-virtual-webcam/src/v-gen-iframe/node_modules/@ffmpeg/ffmpeg/dist/esm/classes.js"),{type:"module"}):new Worker(new URL(a.p+a.u(138),a.b),{type:void 0}),this.#i()),this.#r({type:n.LOAD,data:t},void 0,o));exec=(e,t=-1,{signal:a}={})=>this.#r({type:n.EXEC,data:{args:e,timeout:t}},void 0,a);ffprobe=(e,t=-1,{signal:a}={})=>this.#r({type:n.FFPROBE,data:{args:e,timeout:t}},void 0,a);terminate=()=>{const e=Object.keys(this.#a);for(const t of e)this.#a[t](r),delete this.#a[t],delete this.#t[t];this.#e&&(this.#e.terminate(),this.#e=null,this.loaded=!1)};writeFile=(e,t,{signal:a}={})=>{const o=[];return t instanceof Uint8Array&&o.push(t.buffer),this.#r({type:n.WRITE_FILE,data:{path:e,data:t}},o,a)};mount=(e,t,a)=>this.#r({type:n.MOUNT,data:{fsType:e,options:t,mountPoint:a}},[]);unmount=e=>this.#r({type:n.UNMOUNT,data:{mountPoint:e}},[]);readFile=(e,t="binary",{signal:a}={})=>this.#r({type:n.READ_FILE,data:{path:e,encoding:t}},void 0,a);deleteFile=(e,{signal:t}={})=>this.#r({type:n.DELETE_FILE,data:{path:e}},void 0,t);rename=(e,t,{signal:a}={})=>this.#r({type:n.RENAME,data:{oldPath:e,newPath:t}},void 0,a);createDir=(e,{signal:t}={})=>this.#r({type:n.CREATE_DIR,data:{path:e}},void 0,t);listDir=(e,{signal:t}={})=>this.#r({type:n.LIST_DIR,data:{path:e}},void 0,t);deleteDir=(e,{signal:t}={})=>this.#r({type:n.DELETE_DIR,data:{path:e}},void 0,t)};let u;const f=function(){const e=[{mimeType:"video/mp4;codecs=avc1"},{mimeType:"video/mp4"},{mimeType:"video/webm;codecs=h264"},{mimeType:"video/webm;codecs=vp8"},{mimeType:"video/webm"},{mimeType:"video/x-matroska;codecs=avc1"},{mimeType:"video/ogg"}];for(const t of e)if(MediaRecorder.isTypeSupported(t.mimeType))return t.mimeType}();async function m(e,t){if(!u)return;if(t&&await t(f.includes("h264")))return;await u;const a="input.webm";await p.writeFile(a,await l(e)),f.includes("h264")?await p.exec(["-i",a,"-codec","copy","-strict","-2","output.mp4"]):await p.exec(["-i",a,"-c:v","libx264","-preset","ultrafast","-c:a","aac","output.mp4"]);const n=await p.readFile("output.mp4"),o=new Blob([n],{type:"video/mp4"});return URL.createObjectURL(o)}f.startsWith("video/mp4")||(async()=>{p.on("log",(({message:e})=>{})),u=p.load({coreURL:await d("./res/ffmpeg-core.js","text/javascript"),wasmURL:await d("./res/ffmpeg-core.wasm","application/wasm")})})()}},i={};function r(e){var t=i[e];if(void 0!==t)return t.exports;var a=i[e]={exports:{}};return o[e](a,a.exports,r),a.exports}r.m=o,e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",a="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",n=e=>{e&&e.d<1&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},r.a=(o,i,r)=>{var s;r&&((s=[]).d=-1);var c,l,d,p=new Set,u=o.exports,f=new Promise(((e,t)=>{d=t,l=e}));f[t]=u,f[e]=e=>(s&&e(s),p.forEach(e),f.catch((e=>{}))),o.exports=f,i((o=>{var i;c=(o=>o.map((o=>{if(null!==o&&"object"==typeof o){if(o[e])return o;if(o.then){var i=[];i.d=0,o.then((e=>{r[t]=e,n(i)}),(e=>{r[a]=e,n(i)}));var r={};return r[e]=e=>e(i),r}}var s={};return s[e]=e=>{},s[t]=o,s})))(o);var r=()=>c.map((e=>{if(e[a])throw e[a];return e[t]})),l=new Promise((t=>{(i=()=>t(r)).r=0;var a=e=>e!==s&&!p.has(e)&&(p.add(e),e&&!e.d&&(i.r++,e.push(i)));c.map((t=>t[e](a)))}));return i.r?l:r()}),(e=>(e?d(f[a]=e):l(u),n(s)))),s&&s.d<0&&(s.d=0)},r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.u=e=>e+".bundle.js",r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var a=t.getElementsByTagName("script");if(a.length)for(var n=a.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=a[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),r.b=document.baseURI||self.location.href,r(44)})();